{% extends "base.html" %}

{% block title %}My Gigs - GigUp{% endblock %}

{% block content %}
<div class="my-gigs-page">
    <h1>My Gigs</h1>
    
    <div style="display: flex; gap: 1rem; margin: 1rem 0;">
        <button onclick="showTab('posted')" id="postedTab" class="btn" style="background: #667eea;">
            <i class="fas fa-briefcase"></i> Gigs I Posted
        </button>
        <button onclick="showTab('applications')" id="applicationsTab" class="btn" style="background: #6c757d;">
            <i class="fas fa-paper-plane"></i> My Applications
        </button>
        <button onclick="showTab('contracts')" id="contractsTab" class="btn" style="background: #6c757d;">
            <i class="fas fa-file-contract"></i> Contracts
        </button>
    </div>

    <!-- Posted Gigs Tab -->
    <div id="postedContent" class="tab-content">
        <div style="display: flex; justify-content: between; align-items: center; margin: 1rem 0;">
            <h2>Gigs I've Posted</h2>
            <a href="/create-gig" class="btn">
                <i class="fas fa-plus"></i> Post New Gig
            </a>
        </div>
        <div id="postedGigsList"></div>
    </div>

    <!-- Applications Tab -->
    <div id="applicationsContent" class="tab-content" style="display: none;">
        <h2>My Applications</h2>
        <div id="applicationsList"></div>
    </div>

    <!-- Contracts Tab -->
    <div id="contractsContent" class="tab-content" style="display: none;">
        <h2>My Contracts</h2>
        <div id="contractsList"></div>
    </div>
</div>

<script>
    let currentTab = 'posted';

    function showTab(tabName) {
        // Hide all tab contents
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.style.display = 'none';
        });
        
        // Reset all tab buttons
        document.querySelectorAll('.btn').forEach(btn => {
            if (btn.id.includes('Tab')) {
                btn.style.background = '#6c757d';
            }
        });
        
        // Show selected tab
        document.getElementById(tabName + 'Content').style.display = 'block';
        document.getElementById(tabName + 'Tab').style.background = '#667eea';
        
        currentTab = tabName;
        
        // Load data for the tab
        switch(tabName) {
            case 'posted':
                loadPostedGigs();
                break;
            case 'applications':
                loadApplications();
                break;
            case 'contracts':
                loadContracts();
                break;
        }
    }

    async function loadPostedGigs() {
        try {
            const response = await fetch('/api/user/gigs', {
                credentials: 'include'
            });
            
            if (response.ok) {
                const data = await response.json();
                displayPostedGigs(data.gigs);
            }
        } catch (error) {
            console.error('Error loading posted gigs:', error);
        }
    }

    function displayPostedGigs(gigs) {
        const container = document.getElementById('postedGigsList');
        
        if (gigs.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; padding: 2rem; background: white; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h3>No Gigs Posted Yet</h3>
                    <p>Start by posting your first gig!</p>
                    <a href="/create-gig" class="btn">Post Your First Gig</a>
                </div>
            `;
            return;
        }

        container.innerHTML = gigs.map(gig => `
            <div style="background: white; padding: 1.5rem; margin: 1rem 0; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 1rem;">
                    <div style="flex: 1;">
                        <h3 style="margin: 0 0 0.5rem 0;">
                            <a href="/gig/${gig.id}" style="color: #333; text-decoration: none;">${gig.title}</a>
                        </h3>
                        <p style="margin: 0; color: #666;">
                            Category: ${gig.category} | 
                            Status: <span style="color: ${gig.status === 'open' ? '#28a745' : '#dc3545'}">${gig.status}</span> |
                            Posted: ${new Date(gig.created_at).toLocaleDateString()}
                        </p>
                    </div>
                    <div style="text-align: right;">
                        <h4 style="margin: 0; color: #667eea;">$${gig.pay}</h4>
                    </div>
                </div>
                
                ${gig.description ? `<p style="margin-bottom: 1rem; color: #555;">${gig.description}</p>` : ''}
                
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <a href="/gig/${gig.id}" class="btn">
                        <i class="fas fa-eye"></i> View
                    </a>
                    ${gig.status === 'open' ? `
                        <button onclick="viewApplications(${gig.id})" class="btn" style="background: #17a2b8;">
                            <i class="fas fa-users"></i> View Applications
                        </button>
                    ` : ''}
                </div>
            </div>
        `).join('');
    }

    async function loadApplications() {
        try {
            const response = await fetch('/api/user/applications', {
                credentials: 'include'
            });
            
            if (response.ok) {
                const data = await response.json();
                displayApplications(data.applications);
            }
        } catch (error) {
            console.error('Error loading applications:', error);
        }
    }

    function displayApplications(applications) {
        const container = document.getElementById('applicationsList');
        
        if (applications.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; padding: 2rem; background: white; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h3>No Applications Yet</h3>
                    <p>Start applying to gigs to see them here!</p>
                    <a href="/gigs" class="btn">Browse Gigs</a>
                </div>
            `;
            return;
        }

        container.innerHTML = applications.map(app => `
            <div style="background: white; padding: 1.5rem; margin: 1rem 0; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 1rem;">
                    <div style="flex: 1;">
                        <h3 style="margin: 0 0 0.5rem 0;">
                            <a href="/gig/${app.gig_id}" style="color: #333; text-decoration: none;">${app.title}</a>
                        </h3>
                        <p style="margin: 0; color: #666;">
                            Provider: ${app.provider_name} | 
                            Category: ${app.category} |
                            Status: <span style="color: ${
                                app.status === 'pending' ? '#ffc107' : 
                                app.status === 'accepted' ? '#28a745' : '#dc3545'
                            }">${app.status}</span>
                        </p>
                    </div>
                </div>
                
                ${app.message ? `<p style="margin-bottom: 1rem; color: #555;"><strong>Your message:</strong> ${app.message}</p>` : ''}
                
                <p style="color: #666; font-size: 0.9rem;">
                    Applied: ${new Date(app.created_at).toLocaleString()}
                </p>
            </div>
        `).join('');
    }

    async function loadContracts() {
        try {
            const response = await fetch('/api/user/contracts', {
                credentials: 'include'
            });
            
            if (response.ok) {
                const data = await response.json();
                displayContracts(data.contracts);
            }
        } catch (error) {
            console.error('Error loading contracts:', error);
        }
    }

    function displayContracts(contracts) {
        const container = document.getElementById('contractsList');
        
        if (contracts.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; padding: 2rem; background: white; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h3>No Contracts Yet</h3>
                    <p>Contracts will appear here once gigs are accepted.</p>
                </div>
            `;
            return;
        }

        container.innerHTML = contracts.map(contract => `
            <div style="background: white; padding: 1.5rem; margin: 1rem 0; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 1rem;">
                    <div style="flex: 1;">
                        <h3 style="margin: 0 0 0.5rem 0; color: #333;">${contract.title}</h3>
                        <p style="margin: 0; color: #666;">
                            Between: ${contract.provider_name} and ${contract.seeker_name} |
                            Status: <span style="color: ${
                                contract.status === 'signed' ? '#28a745' : 
                                contract.status === 'pending' ? '#ffc107' : '#dc3545'
                            }">${contract.status}</span>
                        </p>
                    </div>
                    <div style="text-align: right;">
                        <h4 style="margin: 0; color: #667eea;">$${contract.pay}</h4>
                    </div>
                </div>
                
                <p style="margin-bottom: 1rem; color: #555;">
                    <strong>Terms:</strong> ${contract.terms}
                </p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                    <div>
                        <strong>Date:</strong> ${new Date(contract.date).toLocaleDateString()}
                    </div>
                    ${contract.hours ? `<div><strong>Hours:</strong> ${contract.hours}</div>` : ''}
                    <div>
                        <strong>Created:</strong> ${new Date(contract.created_at).toLocaleDateString()}
                    </div>
                </div>
                
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <button onclick="viewContract(${contract.id})" class="btn">
                        <i class="fas fa-eye"></i> View Contract
                    </button>
                    ${contract.status === 'pending' ? `
                        <button onclick="signContract(${contract.id})" class="btn" style="background: #28a745;">
                            <i class="fas fa-signature"></i> Sign Contract
                        </button>
                    ` : ''}
                </div>
            </div>
        `).join('');
    }

    function viewApplications(gigId) {
        // This would open a modal or navigate to applications page
        window.location.href = `/manage-applications?gig_id=${gigId}`;
    }

    function viewContract(contractId) {
        // This would open contract details
        alert(`View contract ${contractId} - to be implemented`);
    }

    function signContract(contractId) {
        // This would open signature interface
        alert(`Sign contract ${contractId} - to be implemented`);
    }

    function viewContract(contractId) {
        window.location.href = `/contract/${contractId}`;
    }

    function signContract(contractId) {
        window.location.href = `/contract/${contractId}`;
    }

    // Load initial data
    showTab('posted');
</script>

<style>
    .tab-content {
        transition: all 0.3s ease;
    }
</style>
{% endblock %}